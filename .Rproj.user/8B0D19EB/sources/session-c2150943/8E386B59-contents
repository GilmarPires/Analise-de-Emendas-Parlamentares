
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(readxl)
library(gridExtra)

# Caminho para o arquivo baixado
file_path <- "Planilha_Emendas_ao_OGU_2024 - V1. Dados Abertos.xlsx"

# Ler a planilha do Excel, pulando a primeira linha
df <- read_excel(file_path, skip = 1)

# Verificar as primeiras linhas do data frame para garantir que o cabeçalho está correto
head(df)


# Filtrar as categorias indesejadas
df <- df %>%
  filter(!UF %in% c(NA, "Não se Aplica", "PDT"))

# Converter a coluna Valor para numérica e ajustar para milhões de R$
df_milhoes <- df %>%
  mutate(Valor = as.numeric(Valor) / 1e6)


######################################### fazer um gráfico de barras com o valor total das emendas por UF



# Converter a coluna Valor para numérica e ajustar para milhões de R$
df_milhoes <- df %>%
  mutate(Valor = as.numeric(Valor) / 1e6)

# Criar o gráfico de barras com estilo personalizado e rótulos de valores
df_milhoes %>%
  group_by(UF) %>%
  summarise(total_emendas = sum(Valor, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(UF, total_emendas), y = total_emendas)) +
  geom_col(fill = "darkgreen") + # Cor das barras em verde escuro
  geom_text(aes(label = paste0("R$", round(total_emendas, 2))), hjust = 0, size = 3, color = "darkgreen") + # Rótulos em branco
  coord_flip() +
  labs(x = "UF", y = "Valor (Milhões de R$)", title = "Valor Total das Emendas por UF") +
  theme_minimal(base_size = 15) + # Aumentar o tamanho da fonte
  theme(
    panel.grid.major = element_blank(), # Remover linhas de grade maiores
    panel.grid.minor = element_blank(), # Remover linhas de grade menores
    panel.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    plot.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    text = element_text(color = "darkgreen", face = "bold"), # Rótulos em verde escuro negrito
    axis.text = element_text(color = "darkgreen", face = "bold"), # Rótulos dos eixos em verde escuro negrito
    axis.title = element_text(color = "darkgreen", face = "bold"), # Título dos eixos em verde escuro negrito
    plot.title = element_text(color = "darkgreen", face = "bold", hjust = 0.5) # Título do gráfico em verde escuro negrito
  )


######################## Fazer um grafico de barras com o valor total das emendas por partido



# Criar o gráfico de barras com estilo personalizado e rótulos de valores
df_milhoes %>%
  group_by(Partido) %>%
  summarise(total_emendas = sum(Valor, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(Partido, total_emendas), y = total_emendas)) +
  geom_col(fill = "darkgreen") + # Cor das barras em verde escuro
  geom_text(aes(label = paste0("R$", round(total_emendas, 2))), hjust = 0, size = 3, color = "darkgreen") + # Rótulos em branco
  coord_flip() +
  labs(x = "Partido", y = "Valor (Milhões de R$)", title = "Valor Total das Emendas por Partido Político") +
  theme_minimal(base_size = 15) + # Aumentar o tamanho da fonte
  theme(
    panel.grid.major = element_blank(), # Remover linhas de grade maiores
    panel.grid.minor = element_blank(), # Remover linhas de grade menores
    panel.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    plot.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    text = element_text(color = "darkgreen", face = "bold"), # Rótulos em verde escuro negrito
    axis.text = element_text(color = "darkgreen", face = "bold"), # Rótulos dos eixos em verde escuro negrito
    axis.title = element_text(color = "darkgreen", face = "bold"), # Título dos eixos em verde escuro negrito
    plot.title = element_text(color = "darkgreen", face = "bold", hjust = 0.5) # Título do gráfico em verde escuro negrito
  )


##################################### criar gráfico de barras com o valor total dos autores das emendas


# Converter a coluna Valor para numérica e ajustar para milhões de R$
df_milhoes <- df %>%
  mutate(Valor = as.numeric(Valor) / 1e6) %>%
  filter(Valor != 0) # Filtrar valores zero

# Criar o gráfico de barras com estilo personalizado e rótulos de valores
df_milhoes %>%
  group_by(Autor) %>%
  summarise(total_emendas = sum(Valor, na.rm = TRUE)) %>%
  top_n(30, total_emendas) %>%
  ggplot(aes(x = reorder(Autor, total_emendas), y = total_emendas)) +
  geom_col(fill = "darkgreen") + # Cor das barras em verde escuro
  geom_text(aes(label = paste0("R$", round(total_emendas, 2))), hjust = -0.1, size = 3, color = "darkgreen") + # Rótulos em verde
  coord_flip() +
  labs(x = "Político", y = "Valor (Milhões de R$)", title = "Valor Total das Emendas por Político") +
  theme_minimal(base_size = 15) + # Aumentar o tamanho da fonte
  theme(
    panel.grid.major = element_blank(), # Remover linhas de grade maiores
    panel.grid.minor = element_blank(), # Remover linhas de grade menores
    panel.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    plot.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    text = element_text(color = "darkgreen", face = "bold"), # Rótulos em verde escuro negrito
    axis.text = element_text(color = "darkgreen", face = "bold"), # Rótulos dos eixos em verde escuro negrito
    axis.title = element_text(color = "darkgreen", face = "bold"), # Título dos eixos em verde escuro negrito
    plot.title = element_text(color = "darkgreen", face = "bold", hjust = 0.5) # Título do gráfico em verde escuro negrito
  )




############ criar um gráfico com o valor total por unidade executora



library(ggplot2)
library(dplyr)
library(gridExtra)
library(grid)

# Converter a coluna Valor para numérica e ajustar para milhões de R$
df_milhoes <- df %>%
  mutate(Valor = as.numeric(Valor) / 1e6) %>%
  filter(Valor != 0) # Filtrar valores zero

# Criar uma tabela de significados das siglas
siglas <- tibble(
  `Unidade Executora` = c("SNLGBTQIA+", "SNDCA", "SNDH", "SNDPD", "SNDPI", "AEDH", "FNDCA", "ADMV", "CNDH", "CNDPI"), 
  Significado = c(
    "Sec. Nac. dos Direitos das Pessoas LGBTQIA+", "Sec. Nac. dos Direitos da Criança e do Adolescente", 
    "Sistema Nac. de Direitos Humanos", "Sec. Nac. dos Direitos da Pessoa com Deficiência", "Sec. Nac. dos Direitos da Pessoa Idosa",
    "Assessoria Especial de Educação e Cultura em Direitos Humanos", "Fundo Nac. para Criança e Adolescente",
    "Assessoria Especial de Defesa da Democracia, Memória e Verdade", "Conselho Nac. de Direitos Humanos",
    "Conselho Nac. dos Direitos da Pessoa Idosa"
  )
)

# Gráfico de barras
p <- df_milhoes %>%
  group_by(`Unidade Executora`) %>%
  summarise(total_emendas = sum(Valor, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(`Unidade Executora`, total_emendas), y = total_emendas)) +
  geom_col(fill = "darkgreen") + # Cor das barras em verde escuro
  geom_text(aes(label = paste0("R$", round(total_emendas, 2))), hjust = -0.1, size = 3, color = "darkgreen") + # Rótulos em verde
  coord_flip() +
  labs(x = "Área", y = "", title = "Valor Total das Emendas por Área em Milhões de R$") +
  theme_minimal(base_size = 15) + # Aumentar o tamanho da fonte
  theme(
    panel.grid.major = element_blank(), # Remover linhas de grade maiores
    panel.grid.minor = element_blank(), # Remover linhas de grade menores
    panel.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    plot.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    text = element_text(color = "darkgreen", face = "bold"), # Rótulos em verde escuro negrito
    axis.text = element_text(color = "darkgreen", face = "bold"), # Rótulos dos eixos em verde escuro negrito
    axis.title = element_text(color = "darkgreen", face = "bold"), # Título dos eixos em verde escuro negrito
    plot.title = element_text(color = "darkgreen", face = "bold", hjust = 0.5) # Título do gráfico em verde escuro negrito
  )

# Tabela com significados das siglas com fonte menor
table_grob <- tableGrob(siglas, theme = ttheme_default(base_size = 8))

# Plotar gráfico e tabela juntos, ajustando a altura da tabela de siglas
grid.arrange(p, table_grob, ncol = 1, heights = c(1, 0.5))


############# criar um grafico com as quantidades de emendas parlamentares por autor

library(ggplot2)
library(dplyr)

# Agrupar os dados e contar a quantidade de emendas por Autor
df_quantidade <- df %>%
  group_by(Autor) %>%
  summarise(quantidade_emendas = n()) %>%
  filter(quantidade_emendas != 0) %>% # Filtrar valores zero
  top_n(30, quantidade_emendas) # Selecionar os 30 autores com maior quantidade de emendas

# Criar o gráfico de barras com estilo personalizado
ggplot(df_quantidade, aes(x = reorder(Autor, quantidade_emendas), y = quantidade_emendas)) +
  geom_col(fill = "darkgreen") + # Cor das barras em verde escuro
  geom_text(aes(label = quantidade_emendas), hjust = -0.1, size = 3, color = "darkgreen") + # Rótulos em verde
  coord_flip() +
  labs(x = "Autor", y = "Quantidade de Emendas", title = "Quantidade de Emendas Parlamentares por Autor") +
  theme_minimal(base_size = 15) + # Aumentar o tamanho da fonte
  theme(
    panel.grid.major = element_blank(), # Remover linhas de grade maiores
    panel.grid.minor = element_blank(), # Remover linhas de grade menores
    panel.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    plot.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    text = element_text(color = 'darkgreen', face = 'bold'), # Rótulos em verde escuro negrito
    axis.text = element_text(color = 'darkgreen', face = 'bold'), # Rótulos dos eixos em verde escuro negrito
    axis.title = element_text(color = 'darkgreen', face = 'bold'), # Título dos eixos em verde escuro negrito
    plot.title = element_text(color = 'darkgreen', face = 'bold', hjust = 0.5) # Título do gráfico em verde escuro negrito
  )


########################## criando um gráfico ocm o valor total das emendas por instituição



# Converter a coluna Valor para numérica e ajustar para milhões de R$
df_milhoes <- df %>%
  mutate(Valor = as.numeric(Valor) / 1e6) %>%
  filter(Valor != 0) # Filtrar valores zero

# Agrupar os dados e somar os valores das emendas por instituição
df_instituicoes <- df_milhoes %>%
  group_by(`Modalidade`) %>%
  summarise(total_emendas = sum(Valor, na.rm = TRUE))

# Criar o gráfico de barras com estilo personalizado
ggplot(df_instituicoes, aes(x = reorder(`Modalidade`, total_emendas), y = total_emendas)) +
  geom_col(fill = "darkgreen") + # Cor das barras em verde escuro
  geom_text(aes(label = paste0("R$", round(total_emendas, 2))), hjust = -0.1, size = 3, color = "darkgreen") + # Rótulos em verde
  coord_flip() +
  labs(x = "Instituição", y = "Valor (Milhões de R$)", title = "Recursos das Emendas Parlamentares por Instituição") +
  theme_minimal(base_size = 15) + # Aumentar o tamanho da fonte
  theme(
    panel.grid.major = element_blank(), # Remover linhas de grade maiores
    panel.grid.minor = element_blank(), # Remover linhas de grade menores
    panel.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    plot.background = element_rect(fill = "lightyellow", color = NA), # Fundo amarelo fraco
    text = element_text(color = 'darkgreen', face = 'bold'), # Rótulos em verde escuro negrito
    axis.text = element_text(color = 'darkgreen', face = 'bold'), # Rótulos dos eixos em verde escuro negrito
    axis.title = element_text(color = 'darkgreen', face = 'bold'), # Título dos eixos em verde escuro negrito
    plot.title = element_text(color = 'darkgreen', face = 'bold', hjust = 0.5) # Título do gráfico em verde escuro negrito
  )

